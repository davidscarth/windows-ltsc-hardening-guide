# Runbook: A Hardening Guide for Windows IoT Enterprise LTSC
**Version:** 1.1.1

**Date:** August 10, 2025

---
## 1.0 Introduction and Scope
This runbook provides a foundational, step-by-step guide for deploying a security-hardened Windows IoT Enterprise LTSC (10 or 11) machine. It is designed for those who want to go beyond default settings to build a resilient and practical daily-use computer.

Whether you are a security-conscious user building a personal machine, a small business IT admin creating a secure baseline for your company, or a cybersecurity professional looking for a hands-on guide, this document provides a robust template.  To use this guide, you should have a working familiarity with Windows environments, general knowledge of computer hardware, and be comfortable using command-line interfaces.

While the primary focus is on workstations, the principles and techniques are foundational. Specific callouts for hardening a low-touch, purpose-built server (ideal for a home lab operator or other dedicated projects) are included as clearly marked deviations. Ultimately, this guide is for anyone who understands that security is a process of managing risk without crippling usability.

*Note: We are assuming standalone installation (machine is not joined to an Active Directory domain). Practices for domain joined machines may differ and are out-of-scope for this guide. Additionally, Enterprise-grade internet-facing servers require further dedicated risk assessment and configuration that is beyond the scope for this guide.*

---
## 2.0 Prerequisites
Before you begin, you must define your threat model. The hardening choices for a general-purpose workstation are different from those for a locked-down, single-purpose application server.

* **Workstation:** The primary threat is user interaction with untrusted content (web browsing, email attachments, USB devices). The goal is to contain potential compromises without crippling usability.
* **Server:** The primary threat is a remote attacker exploiting a vulnerability in an exposed service. The goal is to minimize the attack surface to an absolute minimum and strictly control all activity.

This guide will default to a workstation-oriented threat model. Callouts will be made for ```SERVER``` specific policies where they diverge.

### 2.1 Hardware
A computer that meets or exceeds the minimum requirements for Windows, and supports modern security features.

| Component | Minimum Requirement | Rationale |
|---|---|---|
| **Processor** | Intel Core i7 or i9 (11th Gen or newer) or AMD Ryzen 5000 series (Zen 3 or newer)|	Required for Virtualization-Based Security (VBS) performance. |
| **RAM** | 32 GB memory (ideally 64 GB+) | VBS and containerization have memory overhead. |
| **OS Drive** | 512 GB or larger NVMe SSD | Provides ample storage and performance. |
| **Firmware** | UEFI with Secure Boot | Ensures a trusted boot chain from hardware to OS. |
| **TPM** | TPM 2.0 (Discrete or Firmware-based) | Provides a root of trust for measurements and key protection (for BitLocker). |

### 2.2 Software & OS Image Integrity
* **Operating System:**
    * A legitimate copy of Windows 10/11 IoT Enterprise LTSC obtained from a trusted source, such as the Microsoft 365 Admin Center or a Visual Studio (MSDN) subscription.
* **Security Suite:**
   * Microsoft Defender Antivirus for protection against viruses or malicious code (built-in to Windows).
   * Windows Defender Firewall for protection from unsolicited traffic (built-in to Windows).

#### 2.2.1 OS Image Integrity Verification
**CRITICAL STEP:** Before creating your bootable media, you must verify the cryptographic hash of your downloaded ISO file. This step ensures the file you downloaded is the authentic, unaltered file from Microsoft and has not been tampered with or corrupted.

1. **Get the hashes.** You may obtain these directly from your Microsoft account. For convenience sake, common hashes have been provided here:

Windows 11:
* File: ```en-us_windows_11_iot_enterprise_ltsc_2024_x64_dvd_f6b14814.iso```
* CRC-32: ```482a5898```
* MD5: ```66608a96a4f2d73b4a1d054e76e6eae4```
* SHA-1: ```d5dd0a493b6a9c92f7f2a54bb2fb2544587a15fd```
* SHA-256: ```4f59662a96fc1da48c1b415d6c369d08af55ddd64e8f1c84e0166d9e50405d7a``` (use this one)

Windows 10:
* File: ```en-us_windows_10_iot_enterprise_ltsc_2021_x64_dvd_257ad90f.iso```
* CRC-32: ```188c9d0d```
* MD5: ```2463b19beac328290e6a8adcedb7533a```
* SHA-1: ```76c3c10e38307d29fd8b4748522ed144dba35829```
* SHA-256: ```a0334f31ea7a3e6932b9ad7206608248f0bd40698bfb8fc65f14fc5e4976c160``` (use this one)

2. **Compute the hash** of your downloaded file using the built-in PowerShell ```Get-FileHash``` command.

```powershell
# Replace the path with the actual path to your ISO file
Get-FileHash -Path "C:\Path\To\Your\en-us_windows_11_iot_enterprise_ltsc_2024_x64_dvd_f6b14814.iso" -Algorithm SHA256
```

3. **Compare:** The hash generated by the command must exactly match the official hash from Microsoft (as provided in this guide). If it does not, DO NOT USE THE FILE. Instad, re-download a known good copy.

### 2.3 Required Materials
* Windows 10 or 11 IoT Enterprise LTSC ISO file
* USB Flash Drive (This drive will be formatted, so ensure there is no important data on it)
* A working computer to create the bootable USB drive and copy software/drivers onto it.

---
## 3.0 Installation of Windows

### 3.1 Create a Bootable USB Drive
1.  **Download Rufus:** Download the latest version from the [official website](https://rufus.ie).
2.  **Launch Rufus** and configure it with the following settings:
    * **Device:** Select your USB flash drive.
    * **Boot selection:** Click `SELECT` and browse to your Windows IoT LTSC ISO file.
    * **Image option:** "Standard Windows installation".
    * **Partition scheme:** `GPT`.
    * **Target system:** `UEFI (non CSM)`.
3.  **Click START**. A warning will appear that all data on the USB drive will be destroyed. Click `OK` to continue.
4.  Wait for the process to complete and close Rufus.

### 3.2 BIOS/UEFI Configuration
1.  **Access UEFI/BIOS:** Power on the target server and press the appropriate key (typically `F2`, `F10`, `F12`, or `DEL`) to enter the UEFI/BIOS setup.
2.  **Set a UEFI/BIOS Administrator Password:** This prevents unauthorized changes to firmware settings. Store this password securely.
3.  **Enable UEFI Mode:** Ensure the system is set to boot in UEFI mode (not MBR or Legacy mode).
4.  **Enable Secure Boot:** This is mandatory.
5.  **Enable Virtualization Technology:** Enable Intel VT-x / AMD-V, and also VT-d / IOMMU if available.
6.  **Disable Fast Boot (If available):** To ensure the system boots from the USB drive, disable "Fast Boot" or "Quick Boot" options.
7.  **Disable Unused Hardware:** To reduce the physical attack surface, disable all unused hardware ports and controllers (e.g., FireWire, serial/parallel ports). Thunderbolt should be disabled or restricted (i.e. "DisplayPort Only" mode) to prevent DMA attacks.
8.  **Set Boot Order:** Set the USB drive as the primary boot device for the installation.
9.  **Save and Exit:** Save your changes and exit the BIOS/UEFI setup.

### 3.3 Installation Process
1.  **Boot from USB:** The computer should now boot from the USB drive.
2.  **Language and preferences:** Select your language, time format, and keyboard input, then click **Next**.
        * Windows 11 only: After selecting your "Keyboard or input method", click on "Previous Version of Setup" and start from there.
3.  **Install now:** Click the **Install now** button.
4.  **Product key:** Select “I don’t have a product key”. We will activate Windows later.
5.  **Operating system:** Choose `Windows 10 (or 11) IoT Enterprise LTSC` and click **Next**.
6.  **License terms:** Accept the license terms and click **Next**.
7.  **Installation type:** Select **Custom: Install Windows only (advanced)**.
8.  **Partition the drive:**
    * If you have a new drive, select "Drive 0 Unallocated Space" and click **Next**.
    * If you have existing partitions, delete them all until you only have "Drive 0 Unallocated Space". Select it and click **Next**.
9.  **Install Windows:** The installation process will start, and the computer will restart as needed.
10. **Out-of-Box Experience (OOBE):**
    * **Network:** Select “I don’t have internet” and then either “Continue with limited setup” (Windows 10) or "I don’t have internet" again (Windows 11).
    * **Account:** Create a local administrator account.
        * Use a generic name (not “Admin” or “Administrator”).
        * Use a strong, randomly generated passphrase and store it in a password manager.
        * For the security questions, use a random password generator for the answers and store them securely.
            * To avoid security questions, instead leave the password <blank> during setup, and create one later.
    * **Privacy settings:** Toggle each option off and select **Accept**.

---
## 4.0 Post-Installation Hardening and Configuration
> **IMPORTANT:** Do not connect the machine to the network until this phase is complete. All required drivers and tools should be downloaded on a separate, trusted computer and transferred via USB.
 
### 4.1 Firmware and Drivers
1.  **Update Firmware:** Download and install the latest system BIOS and any other available firmware updates if available (TPM module, Thunderbolt controller, etc.).
2.  **Install Drivers:** Download and install the latest official chipset, graphics, and network drivers from the manufacturer's website.
3.  **Check Device Manager:** Right-click the Start button, select **Device Manager**, and look for any devices with a yellow exclamation mark. Obtain any missing drivers from official sources and install them.

### 4.2 Core Operating System Hardening
We will apply two baselines sequentially: first, the general security baseline, and then the more restrictive privacy baseline (RTLFB).

* **Windows Security Baseline:** This is the most significant hardening step in this guide. This baseline configures hundreds of security settings to lock down the system. Beyond enabling Virtualization-Based Security (VBS) and Credential Guard, it also disables legacy protocols like SMBv1 and LM/NTLM authentication, and configures Attack Surface Reduction (ASR) rules to block common malware behaviors like Office-based attacks and script obfuscation.
* **Restricted Traffic Limited Functionality Baseline (RTLFB):** Enhances privacy by aggressively curtailing telemetry and other non-essential outbound communications to Microsoft.

**To Apply:**
1.  **Download Baselines and LGPO Tool:**

    <ins>Windows 10:</ins>
    * Download the ["Windows 10 version 21H2 Security Baseline.zip"](https://www.microsoft.com/en-us/download/details.aspx?id=55319) and extract the contents of the `Windows-10-v21H2-Security-Baseline` folder to `C:\Temp\Baselines\Security`.
    * Download the [Restricted Traffic Limited Functionality Baseline from Archive.org](https://web.archive.org/web/20230601002534/https://download.microsoft.com/download/D/9/0/D905766D-FEDA-43E5-86ED-8987CEBD8D89/WindowsRTLFB.zip) (as Microsoft removed the required version). Extract the contents of the `Enterprise` folder from 'Version 21H2_Win10' to `C:\Temp\Baselines\Privacy`.
    
    <ins>Windows 11:</ins>
    * Download the ["Windows 11 v24H2 Security Baseline.zip"](https://www.microsoft.com/en-us/download/details.aspx?id=55319) and extract the contents of the `Windows 11 v24H2 Security Baseline` folder to `C:\Temp\Baselines\Security`.
    * Download the [Restricted Traffic Limited Functionality Baseline](https://download.microsoft.com/download/D/9/0/D905766D-FEDA-43E5-86ED-8987CEBD8D89/WindowsRTLFB.zip). Extract the contents of the `Enterprise` folder from `Version 23H2_Win11` to `C:\Temp\Baselines\Privacy`.
    
    <ins>GPO Tool:</ins>:
    * Download [LGPO.exe](https://www.microsoft.com/en-us/download/details.aspx?id=55319).
    * Copy `LGPO.exe` to `C:\Temp\Baselines\Security\Scripts\Tools\`.

2.  **Open PowerShell as Administrator** and set the execution policy:
    ```powershell
    Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope Process
    ```
    When prompted to confirm the change, type **Y** and press **Enter**. The command is scoped for this session only.
    
4.  **Apply Microsoft Security Baseline:**

    Windows 10:
    ```powershell
    cd C:\Temp\Baselines\Security\Scripts
    .\Baseline-LocalInstall.ps1 -Win10NonDomainJoined
    ```
    Windows 11:
    ```powershell
    cd C:\Temp\Baselines\Security\Scripts
    .\Baseline-LocalInstall.ps1 -Win11NonDomainJoined
    ```
    Do not close the PowerShell window yet, use the same window and proceed to the next step.
    
5.  **Apply Restricted Traffic Baseline:**
    ```powershell
    cd C:\Temp\Baselines\Privacy
    .\RestrictedTraffic_ClientEnt_Install.cmd C:\Temp\Baselines\Security\Scripts\Tools\
    
    ```
    When prompted to agree to the settings, type **Y** and press **Enter**.
    
6.  **Reboot** the computer.

### 4.2.1 Group Policy Adjustments
The RTLFB is aggressive at disabling communication with Microsoft, which in turn disables the functionality of some essential components. We must now manually re-enable them. Open the Local Group Policy Editor (gpedit.msc) and configure the following policies as follows:

> **NOTE:** In a future version of this guide, I will include a powershell script to automate the changes.

#### Windows RTLFB Adjustments
* **Re-enable Windows Update and Automatic Root Certificates Updates:**
    * `Computer Configuration\Administrative Templates\System\Internet Communication Management\Internet Communication settings`
        * `Turn off access to all Windows Update features` -> **Not Configured**
        * `Turn off Automatic Root Certificates Update` -> **Not Configured**
    * `Computer Configuration\Administrative Templates\Windows Components\Windows Update`
        * `Specify intranet Microsoft update service location` -> **Not Configured**
        * `Do not connect to any Windows Update Internet locations` -> **Not Configured**
* **Re-enable Defender signature updates:**
    * `Computer Configuration\Administrative Templates\Windows Components\Microsoft Defender Antivirus\Security Intelligence Updates`
        * `Define file shares for downloading security intelligence updates` -> **Not Configured**
        * `Define the order of sources for downloading security intelligence updates` -> **Not Configured**
* **Re-enable Windows Time service:**
    * `Computer Configuration\Administrative Templates\System\Windows Time Service\Time Providers`
        * `Enable Windows NTP Client` -> **Enabled**

#### Security Baseline Adjustments
* **Enhance BitLocker encryption strength:**
    * `Computer Configuration\Administrative Templates\Windows Components\BitLocker Drive Encryption`
        * `Choose drive encryption method and cipher strength (Windows 10 (Version 1511) and later)` -> **Enabled**
        * Set encryption method for 'Operating System' and 'Fixed Data Drives' to **"XTS-AES 256-bit"**.
* **Disable "Block untrusted and unsigned processes that run from USB" (ASR Rule):**
    * `Computer Configuration\Administrative Templates\Windows Components\Microsoft Defender Antivirus\Microsoft Defender Exploit Guard\Attack Surface Reduction`
        * `Configure Attack Surface Reduction rules` -> Click 'Show...' -> Delete the rule for `"b2b3f03d-6a65-4f7b-a9c7-1c7ef74a9ba4"` by erasing the Value Name and Value and hit 'OK'.
* **Disable "Deny write access to fixed drives not protected by BitLocker":**
    * `Computer Configuration\Administrative Templates\Windows Components\BitLocker Drive Encryption\Removable Data Drives`
        * `Deny write access to removable drivers not protected by BitLocker` -> **Not Configured**

#### Optional Adjustments
* **Do not include drivers with Windows Updates:**
    * `Computer Configuration\Administrative Templates\Windows Components\Windows Update`
        * `Do not include drivers with Windows Updates` -> **Enabled**
* **Allow network activity indicator tests:**
    * `Computer Configuration\Administrative Templates\System\Internet Communication Management\Internet Communication settings`
        * `Turn off Windows Network Connectivity Status Indicator active tests` -> **Not configured**
* **Allow user to enable webcam and microphones:**
    * `Computer Configuration\Administrative Templates\Windows Components\App Privacy`
        * `Let Windows apps access the camera` -> **Enabled**, change 'Default for all apps' from "Force Deny" to **"User is in control"**
        * `Let Windows apps access the microphone` -> **Enabled**, change 'Default for all apps' from "Force Deny" to **"User is in control"**

### 4.2.1 Registry Adjustments
A few settings from the baselines are configured within the registry. Use the Registry Editor (`regedit.exe`) to make the following adjustments manually:

#### Security Baseline Tweaks
* **Enable Local Security Authority (LSA) Protection** (On by default in Windows 11, but we need to enable it in Windows 10)
    * Create DWORD `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\RunAsPPL` set to `1`
    * Create DWORD `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\RunAsPPLBoot` set to `1`
* **Enable opportunistic SMB signing (server side)** (It's already set as required, this is housekeeping)
    * Modify registry DWORD 'HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters\enablesecuritysignature' from `0` to `1'.
* **Re-enable Microsoft Edge updates:**
    * Delete registry key: `HKLM\SOFTWARE\Policies\Microsoft\EdgeUpdate`
    * Delete registry key: `HKLM\SOFTWARE\WOW6432Node\Microsoft\EdgeUpdateDev`
    * Modify registry DWORD `HKLM\SOFTWARE\Policies\Microsoft\Edge\ExperimentationAndConfigurationServiceControl` from `0` to `1`.
* **Re-enable Automatic Root Certificates auto-updates:**
    * Delete registry key (if exists): `HKLM\SOFTWARE\Policies\Microsoft\SystemCertificates\AuthRoot`

### 4.2.2 Firewall State and Configuration
The baselines leave the Windows Defender Firewall in its default state: inbound traffic is **blocked** unless a rule allows it.

There are some considerations here for *further* hardening, depending on your use case and goals.

* **Workstation:** If you are hardening a workstation, or if this is a homelab server doubling as a workstation, **skip this section**. Setting outbound to default-deny will hamper usability.
* **Server:** If this server is intended for a production-grade deployment, continue onward. We want to strictly control allowed outbound traffic.

Setting the firewall to default-deny outbound traffic:

Since the firewall settings were changed using Group Policy when the baselines were applied, we'll need to use Group Policy to modify them.

This PowerShell script will help automate the process: [firewall.ps1](code/firewall.ps1). *It assumes LGPO.exe is in the same directory as when we applied our baselines, update the path if needed.*

Open PowerShell as Administrator and perform the following:
 ```powershell
# 1. Change to the script's directory
cd "C:\path\to\the\script"

# 2. Set the execution policy
Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope Process

# 3. Run the script
.\firewall.ps1
```
Now create rules using powershell to enable egress for the following (this will be your base allowlist):

1. Name resolution (DNS) (assuming DNS is handled by your firewall at 192.168.1.1)
    ```powershell
    # Replace 192.168.1.1 with where your DNS queries actually need to go
    New-NetFirewallRule -DisplayName "DNS out (Dnscache TCP)" -Dir Out -Action Allow -Protocol TCP -RemotePort 53 -RemoteAddress 192.168.1.1 -Service Dnscache
    New-NetFirewallRule -DisplayName "DNS out (Dnscache UDP)" -Dir Out -Action Allow -Protocol UDP -RemotePort 53 -RemoteAddress 192.168.1.1 -Service Dnscache
    ```
2. Time sync (NTP) (scoped to W32Time so you can use any Time service)
    ```powershell
   New-NetFirewallRule -DisplayName "NTP out (W32Time → Any)" -Dir Out -Action Allow -Protocol UDP -RemotePort 123 -Program "$env:SystemRoot\System32\svchost.exe" -Service W32Time
   ```
3. Certificate revocation checks (CRL/OCSP)
    ```powershell
   New-NetFirewallRule -DisplayName "Certificate revocation checks (CryptSvc)" -Dir Out -Action Allow -Program "%SystemRoot%\System32\svchost.exe" -Service CryptSvc -Protocol TCP -RemotePort 80,443
   ```
4. Windows Update
    ```powershell
   New-NetFirewallRule -DisplayName "Windows Update (wuauserv)" -Dir Out -Action Allow -Program "%SystemRoot%\System32\svchost.exe" -Service wuauserv -Protocol TCP -RemotePort 80,443
   ```
Now you will create entries for any servers or services that you use.
We will assume all of your traffic and services will be fronted by a reverse-proxy, so you should only need to forward that additional traffic.

5. Network Attached Storage (Assuming in this example an SMB share for two devices)
    ```powershell
    New-NetFirewallRule -DisplayName "SMB to NAS" -Dir Out -Action Allow -Protocol TCP -RemotePort 445 -RemoteAddress 10.10.20.10,10.10.20.11
    ```
6. Reverse Proxy (Using [Caddy](https://github.com/caddyserver/caddy) as an example, needs to access ACME API, fetch OCSP/issuer)
    ```powershell
    New-NetFirewallRule -DisplayName "Caddy ACME/Cloudflare" -Dir Out -Action Allow -Program "C:\Program Files\Caddy\caddy.exe" -Protocol TCP -RemotePort 80,443
    ```
### 4.3 Drive Encryption with BitLocker
1.  Run in PowerShell as Administrator:
    ```powershell
    manage-bde -on C: -RecoveryPassword
    ```
2.  **CRITICAL:** Immediately copy the 48-digit Recovery Key ("Password") and store it in a secure, separate location like a password manager. Failure to do so will result in permanent data loss.
3.  Check progress with `manage-bde -status C:`.

### 4.5 OS Activation and Housekeeping
**YOU MAY NOW CONNECT TO THE INTERNET**

#### 4.5.1 Time and Power
Open the "Date & time" settings and make sure your time zone is correct, and that the time is accurate. You can toggle on "Set time automatically" and then click "Sync now" to get in sync with internet time servers.

Open your "Power & sleep" settings. Change the power plan options to disable sleep when plugged in (for "Make my device sleep after", select "Never").

#### 4.5.2 Activation
The recommended and most secure method for activation is to use a legitimate product key obtained through official channels (e.g., Volume Licensing, Visual Studio Subscription).

1. Open Settings -> Update & Security -> Activation.
2. Select "Change product key" and enter your key.

For non-production, lab, or testing environments, an alternative procedure using Microsoft Activation Scripts (MAS) is [documented separately](appendix/ALT-ACTIVATION.md). Please refer to that document for instructions.

#### 4.5.3 One-time Windows Update

We will run Windows update initially to get to the most current security patch level, and rely on auto-updates going forward.

Go to Settings, "Update & Security", and in "Windows Update" you will click "Check for updates". Allow updates to download and install. Once the updates finish, you may click "Restart now" or restart your machine to apply them.

### 5. Final Words

This guide helps you get to a secure baseline to start from, but it is not a self-maintaining ecosystem. You will need to still need to think and act with security in mind as you use your newly set-up device.

**Use trustworthy software:** Obtain legitimate software from official or trusted sources.

**Stay Updated:** Regularly check for and install Windows Updates and application patches.

**Make Backups:** Regularly back up your important data to a separate location. A hardened OS does not protect against hardware failure or user error.

---
